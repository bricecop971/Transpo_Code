<!DOCTYPE html>
<html>
<head>
    <title>Test Ultime</title>
    <style>
        body { font-family: sans-serif; text-align: center; padding: 50px; background: #111; color: white; }
        button { padding: 15px 30px; font-size: 18px; cursor: pointer; background: #00e5ff; border: none; border-radius: 5px; font-weight: bold; }
        #result { margin-top: 30px; font-size: 20px; white-space: pre-wrap; background: #222; padding: 20px; border-radius: 10px; text-align: left; display: inline-block; min-width: 300px; }
    </style>
</head>
<body>
    <h1>üì° Test de Connexion Vercel</h1>
    <p>Ce test v√©rifie si votre site peut parler √† Google.</p>
    
    <button onclick="runTest()">LANCER LE TEST</button>
    
    <br>
    <div id="result">En attente...</div>

    <script>
        async function runTest() {
            const out = document.getElementById('result');
            out.innerText = "‚è≥ 1. Envoi de la demande au serveur Vercel...";
            out.style.color = "yellow";
            out.style.border = "1px solid yellow";

            try {
                // On met un timeout de 8 secondes pour ne pas rester bloqu√©
                const controller = new AbortController();
                const timeoutId = setTimeout(() => controller.abort(), 8000);

                const res = await fetch('/api/analyze', { 
                    method: 'POST',
                    signal: controller.signal // Lie le timeout
                });
                
                clearTimeout(timeoutId); // On arr√™te le chrono

                out.innerText += "\n‚è≥ 2. R√©ponse re√ßue ! Lecture...";

                if (res.status === 404) {
                    throw new Error("ERREUR 404 : Le fichier api/analyze.js n'existe pas ou est mal plac√© sur GitHub.");
                }

                const data = await res.json();

                if (data.error) {
                    throw new Error("ERREUR DU SERVEUR : " + data.error);
                }

                out.innerText = "‚úÖ SUCC√àS TOTAL !\n\nMessage du serveur : " + data.message + "\nR√©ponse de l'IA : " + data.ia_response;
                out.style.color = "#00ff00";
                out.style.border = "2px solid #00ff00";

            } catch (e) {
                let msg = e.message;
                if (e.name === 'AbortError') {
                    msg = "TIMEOUT : Le serveur Vercel a mis trop de temps √† r√©pondre (> 8s).\nCela veut dire que la cl√© API est peut-√™tre invalide ou que Google bloque la requ√™te.";
                }
                out.innerText = "‚ùå √âCHEC : " + msg;
                out.style.color = "#ff5555";
                out.style.border = "2px solid red";
            }
        }
    </script>
</body>
</html>
